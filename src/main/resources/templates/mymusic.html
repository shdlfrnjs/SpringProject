<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8">
  <title>My Music</title>
  <!-- mymusic.html ê³ ìœ  CSS ì¶”ê°€ -->
  <th:block layout:fragment="css">
    <style>
      .d-flex {
        display: flex;
        align-items: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
      }

      .justify-content-between {
        justify-content: space-between; /* ì–‘ìª½ ëìœ¼ë¡œ ë°°ì¹˜ */
      }

      h2 {
        margin-left: 10px; /* ì™¼ìª½ ì—¬ë°± ì¶”ê°€ */
      }

      /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
      .music-list {
        width: 100%;
        border-collapse: collapse; /* í…Œë‘ë¦¬ ì¤‘ë³µ ì œê±° */
        margin: 0; /* í…Œì´ë¸” ìƒí•˜ ì—¬ë°± */
        font-size: 1em;
        font-family: Arial, sans-serif;
      }

      .music-list th, .music-list td {
        padding: 10px 15px; /* ì…€ ì•ˆìª½ ì—¬ë°± */
        text-align: center; /* í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
        border-bottom: 1px solid #ddd; /* ì…€ ì•„ë˜ í…Œë‘ë¦¬ */
      }

      .music-list thead th {
        background-color: #f8f9fa; /* í—¤ë” ë°°ê²½ìƒ‰ */
        font-weight: bold;
        text-align: center; /* í—¤ë” í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬ */
        border-bottom: 2px solid #dee2e6; /* í—¤ë” í…Œë‘ë¦¬ ê°•ì¡° */
      }

      /* ê³¡ì •ë³´ ì…€ ìŠ¤íƒ€ì¼ */
      .music-info {
        display: flex; /* ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ë¥¼ ê°€ë¡œ ì •ë ¬ */
        align-items: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
      }

      .music-info img {
        width: 60px; /* ì´ë¯¸ì§€ ë„ˆë¹„ */
        height: 60px; /* ì´ë¯¸ì§€ ë†’ì´ */
        margin-right: 15px; /* ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ ê°„ ê°„ê²© */
        border-radius: 5px; /* ì´ë¯¸ì§€ ë‘¥ê¸€ê²Œ ì²˜ë¦¬ */
        object-fit: cover; /* ì´ë¯¸ì§€ í¬ê¸°ì— ë§ê²Œ ì¡°ì • */
      }

      .music-details {
        text-align: left; /* í…ìŠ¤íŠ¸ ì™¼ìª½ ì •ë ¬ */
      }

      .music-title a {
        font-weight: bold;
        font-size: 1.1em; /* ì œëª© í¬ê¸° */
        text-decoration: none; /* ë§í¬ ë°‘ì¤„ ì œê±° */
        color: #333; /* ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
      }

      .music-title a:hover {
        color: #007bff; /* í˜¸ë²„ ì‹œ ê°•ì¡° ìƒ‰ìƒ */
      }

      .music-singer a {
        font-size: 0.9em; /* ê°€ìˆ˜ ì´ë¦„ í¬ê¸° */
        color: #6c757d; /* ë³´ì¡° í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
        text-decoration: none; /* ë§í¬ ë°‘ì¤„ ì œê±° */
      }

      .music-singer a:hover {
        color: #0056b3; /* ê°€ìˆ˜ ë§í¬ í˜¸ë²„ ìƒ‰ìƒ */
      }

      /* í…Œì´ë¸” ì—´ ìŠ¤íƒ€ì¼ */
      .music-list td:last-child, .music-list th:last-child {
        text-align: center; /* ë§ˆì§€ë§‰ ì—´ ì¤‘ì•™ ì •ë ¬ */
      }

      .music-list tr:hover {
        background-color: #f1f3f5; /* í–‰ì— í˜¸ë²„ ì‹œ ë°°ê²½ìƒ‰ */
      }

      /* ê¸°ë³¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
      .btn-remove-to-playlist {
        background-color: transparent; /* ë°°ê²½ìƒ‰ íˆ¬ëª… */
        color: #000; /* ì•„ì´ì½˜ ìƒ‰ìƒ ê²€ì • */
        border: none; /* ê²€ì •ìƒ‰ í…Œë‘ë¦¬ */
        padding: 6px 10px; /* ì‘ì€ ì—¬ë°± */
        font-size: 1.2rem; /* ì•„ì´ì½˜ í¬ê¸° ì‘ê²Œ */
        border-radius: 50%; /* ì›í˜• ë²„íŠ¼ */
        display: flex; /* ì•„ì´ì½˜ ì¤‘ì•™ ì •ë ¬ */
        align-items: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
        justify-content: center; /* ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
        cursor: pointer; /* í¬ì¸í„° ëª¨ì–‘ìœ¼ë¡œ ë³€ê²½ */
        transition: transform 0.2s ease; /* í˜¸ë²„ ì‹œ íš¨ê³¼ */
      }

      /* í˜¸ë²„ ì‹œ ê°„ë‹¨í•œ íš¨ê³¼ */
      .btn-remove-to-playlist:hover {
        transform: scale(1.2); /* ë²„íŠ¼ í¬ê¸° ì‚´ì§ ì»¤ì§ */
      }

      /* í´ë¦­ ì‹œ íš¨ê³¼ */
      .btn-remove-to-playlist:active {
        transform: scale(0.95); /* í´ë¦­ ì‹œ ë²„íŠ¼ í¬ê¸° ì¶•ì†Œ */
      }

      /* ë²„íŠ¼ í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼ (í‚¤ë³´ë“œ ì ‘ê·¼ì„±) */
      .btn-remove-to-playlist:focus {
        outline: none; /* ê¸°ë³¸ ì•„ì›ƒë¼ì¸ ì œê±° */
      }

      .music-list td form {
        display: flex; /* flexboxë¡œ ì¤‘ì•™ ì •ë ¬ */
        justify-content: center; /* ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
        align-items: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
        margin: 0; /* ê¸°ë³¸ ì—¬ë°± ì œê±° */
      }

      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
        gap: 5px;
      }

      .pagination a {
        display: inline-block;
        padding: 8px 12px;
        margin: 0 4px;
        color: black;
        text-decoration: none;
        border: 1px solid black;
        border-radius: 4px;
        transition: background-color 0.3s, color 0.3s;
      }

      .pagination a:hover {
        background-color: black;
        color: white;
      }

      .pagination a.active {
        background-color: black;
        color: white;
        pointer-events: none; /* í™œì„±í™”ëœ í˜ì´ì§€ëŠ” í´ë¦­ ë¶ˆê°€ */
      }

      .pagination a.disabled {
        color: #aaa;
        border-color: #aaa;
        pointer-events: none; /* ë¹„í™œì„±í™”ëœ ë²„íŠ¼ì€ í´ë¦­ ë¶ˆê°€ */
      }
      .albums {
        text-align: center;
      }

      .album-list {
        display: flex;
        flex-wrap: wrap;  /* ì—¬ëŸ¬ ì¤„ë¡œ ì •ë ¬ë˜ë„ë¡ ì„¤ì • */
        gap: 50px;  /* ì•„ì´í…œ ê°„ ê°„ê²© */
        justify-content: center;  /* ì¤‘ì•™ ì •ë ¬ */
      }

      .album-item {
        padding: 15px;
        width: 200px;  /* ì•¨ë²” ì»¤ë²„ì˜ ê°€ë¡œ í¬ê¸° */
        text-align: center;
        border-radius: 16px;  /* ê¸°ë³¸ì ìœ¼ë¡œ ë‘¥ê·¼ í…Œë‘ë¦¬ */
        transition: transform 0.3s ease, border-radius 0.3s ease;  /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ í™•ëŒ€ ë° ë‘¥ê·¼ í…Œë‘ë¦¬ íš¨ê³¼ */
      }

      .album-item:hover {
        transform: scale(1.02);  /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ì¹´ë“œê°€ ì‚´ì§ í™•ëŒ€ë¨ */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);  /* ì¹´ë“œì— ê·¸ë¦¼ì íš¨ê³¼ ì¶”ê°€ */
        border-radius: 16px;  /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ì•¨ë²” ì•„ì´í…œì˜ í…Œë‘ë¦¬ê°€ ë‘¥ê¸€ì–´ì§ */
      }

      .album-cover-container {
        width: 100%;  /* ì´ë¯¸ì§€ í¬ê¸° ë§ì¶”ê¸° */
        display: flex;
        justify-content: center;  /* ì•¨ë²” ì»¤ë²„ë¥¼ ì¤‘ì•™ ì •ë ¬ */
      }

      .album-cover {
        width: 100%;  /* ì•¨ë²” ì»¤ë²„ê°€ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶°ì§€ê²Œ */
        height: auto;  /* ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ í¬ê¸° ë§ì¶”ê¸° */
        border-radius: 8px;  /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ì¶”ê°€ */
      }

      .album-info {
        margin-top: 10px;
      }

      .album-info h3 {
        font-size: 1rem;
        font-weight: bold;
      }

      .music-title {
        font-size: 1rem;
        font-weight: bold;

        color: #666;
        margin: 2px 0; /* ìœ„ì•„ë˜ ê°„ê²©ì„ 2pxë¡œ ì„¤ì • */
      }

      .music-singer {
        font-size: 0.9rem;
        color: #666;
        margin: 2px 0; /* ìœ„ì•„ë˜ ê°„ê²©ì„ 2pxë¡œ ì„¤ì • */
      }

      .album-list{
        margin-bottom: 15px;
      }
      .favorite-title {
        font-weight: bold;  /* ê¸€ì”¨ êµµê²Œ ì„¤ì • */
        font-size: 1.2rem;  /* ì œëª© í¬ê¸° ì„¤ì • */
        color: #2c3e50;  /* ì§„í•œ íšŒìƒ‰ */
        text-align: center;  /* ì¤‘ì•™ ì •ë ¬ */
        line-height: 1.4;  /* ì¤„ ê°„ê²© ì¡°ì • */
        margin-top: 40px;  /* ìƒí•˜ ì—¬ë°± ì¶”ê°€ */
        letter-spacing: 0.5px;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);  /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì íš¨ê³¼ */
      }

      .singer-name {
        font-weight: bold; /* ì¼ë°˜ êµµê¸° */
        background-color: rgba(174, 225, 252, 0.5); /* í•˜ëŠ˜ìƒ‰ ë°°ê²½ (50% íˆ¬ëª…ë„) */
        border-radius: 5px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
        padding: 2px 5px; /* ë°°ê²½ ìƒ‰ì´ í…ìŠ¤íŠ¸ë¥¼ ê°ì‹¸ë„ë¡ ì—¬ë°± ì¶”ê°€ */
        transition: color 0.3s ease, background-color 0.3s ease; /* ìƒ‰ìƒê³¼ ë°°ê²½ ë³€í™” ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
      }


      .suggested-album-title {
        font-size: 1rem;  /* ê¸€ì í¬ê¸°ë¥¼ ì‘ê²Œ ì„¤ì • */
        color: #7f8c8d;  /* ë¶€ë“œëŸ¬ìš´ íšŒìƒ‰ */
        font-weight: 400;  /* ì–‡ì€ ê¸€ì”¨ */
        text-align: center;  /* ì¤‘ì•™ ì •ë ¬ */
        margin: 20px 0;  /* ìœ„ì•„ë˜ ì—¬ë°± */
        letter-spacing: 0.5px;  /* ê¸€ì ê°„ê²©ì„ ì•½ê°„ ë„“í˜€ì„œ ê°€ë…ì„± í–¥ìƒ */
        font-family: 'Roboto', sans-serif;  /* ê¹”ë”í•˜ê³  í˜„ëŒ€ì ì¸ ê¸€ê¼´ ì‚¬ìš© */
      }
      .section-divider {
        margin: 30px 0; /* ìœ„ì•„ë˜ ì—¬ë°± */
        border-top: 2px solid #ddd; /* êµ¬ë¶„ì„  ë‘ê»˜ì™€ ìƒ‰ìƒ */
        width: 100%; /* í™”ë©´ ê°€ë¡œë¡œ ê½‰ ì°¨ë„ë¡ */
      }


    </style>
  </th:block>
</head>
<body>
<!-- Content -->
<div layout:fragment="content">
  <!-- 1ë²ˆ My Music ì½˜í…ì¸  -->
  <div>
    <div class="d-flex justify-content-between">
      <h2>
        <i class="fa-solid fa-folder"></i>
        ë‚´ê°€ ë‹´ì€ ìŒì•… (<span th:text="${totalItems}"></span>)
      </h2>
    </div>
    <table class="music-list">
      <thead>
      <tr>
        <th>ë²ˆí˜¸</th>
        <th>ê³¡ì •ë³´</th>
        <th>ì•¨ë²”</th>
        <th>ì‚­ì œ</th>
      </tr>
      </thead>
      <tbody th:each="music, iterStat : ${musics}">
      <tr>
        <td th:text="${(currentPage - 1) * size + iterStat.index + 1}"></td>
        <td class="music-info">
          <img th:src="@{/img/album/{image}(image=${music.image})}" alt="ì•¨ë²” ì´ë¯¸ì§€">
          <div class="music-details">
            <div class="music-title">
              <a th:href="@{/music/{idx}(idx=${music.idx})}" th:text="${music.title}"></a>
            </div>
            <div class="music-singer">
              <a th:href="@{/artist/{singer}(singer=${music.singer})}" th:text="${music.singer}"></a>
            </div>
          </div>
        </td>
        <td th:text="${music.album}"></td>
        <td>
          <form id="remove-form-{{music.idx}}">
            <input type="hidden" name="musicId" th:value="${music.idx}" />
            <button type="submit" class="btn-remove-to-playlist">
              <i class="fa-solid fa-trash"></i> <!-- ì‚­ì œ ì•„ì´ì½˜ -->
            </button>
          </form>
        </td>
        <script>
          document.querySelectorAll('form[id^="remove-form-"]').forEach(form => {
            form.addEventListener('submit', function(event) {
              event.preventDefault();

              const button = this.querySelector('button');
              button.disabled = true;
              const musicId = this.querySelector('input[name="musicId"]').value;

              // ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
              if (this.classList.contains('submitted')) {
                return;
              }

              this.classList.add('submitted');

              fetch('/removeMyMusic', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                  'musicId': musicId
                })
              })
                      .then(response => response.json())
                      .then(data => {
                        alert(data.message);
                        this.closest('tr').remove();  // í…Œì´ë¸”ì—ì„œ ì‚­ì œëœ í•­ëª© ì—…ë°ì´íŠ¸
                      })
                      .catch(error => {
                        alert('ìŒì•… ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error);
                        button.disabled = false;
                        this.classList.remove('submitted');
                      });
            });
          });
        </script>
      </tr>
      </tbody>
    </table>

    <!-- í˜ì´ì§• ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="pagination">
      <div th:if="${currentPage > 1}">
        <a th:href="@{ /mymusic(page=${currentPage - 1}, size=10, sort=${selectedSort}) }" th:text="'ì´ì „'"></a>
      </div>
      <div th:if="${currentPage == 1}">
        <a class="disabled" th:text="'ì´ì „'"></a>
      </div>

      <div th:each="i : ${#numbers.sequence(1, totalPages)}">
        <a th:href="@{ /mymusic(page=${i}, size=10, sort=${selectedSort}) }" th:classappend="${i == currentPage ? 'active' : ''}" th:text="${i}"></a>
      </div>

      <div th:if="${currentPage < totalPages}">
        <a th:href="@{ /mymusic(page=${currentPage + 1}, size=10, sort=${selectedSort}) }" th:text="'ë‹¤ìŒ'"></a>
      </div>
      <div th:if="${currentPage == totalPages}">
        <a class="disabled" th:text="'ë‹¤ìŒ'"></a>
      </div>
    </div>
  </div>

  <div class="section-divider"></div>

  <div class="d-flex justify-content-between">
    <h2>
      <i class="fa-solid fa-hand-holding-heart"></i>
      ë‹¹ì‹ ì˜ ì·¨í–¥ì„ ë‹´ì€ ì¶”ì²œ
    </h2>
  </div>
  <!-- ê°€ì¥ ë§ì´ ë‹´ê¸´ ê°€ìˆ˜ì˜ ìŒì•… ì¶œë ¥ -->
  <h1 class="favorite-title">
    ğŸ¤– ìŠ¤í”„ë§ë‹˜ì´ ì„ í˜¸í•˜ì‹œëŠ” ê°€ìˆ˜ëŠ” "<span class="singer-name" th:text="${mostFrequentSinger}"></span>" ì…ë‹ˆë‹¤.
  </h1>

  <div class="albums">
    <p class="suggested-album-title">ì´ ê°€ìˆ˜ì˜ ë‹¤ë¥¸ ì•¨ë²”ë„ ì¶”ì²œë“œë ¤ìš”!</p>
    <div class="album-cover-container">
      <div class="album-list">
        <div th:each="music : ${randomAlbums}">
          <div class="album-item">
            <a th:href="@{/artist/{singer}(singer=${music.singer})}">
              <img th:src="@{/img/album/{image}(image=${music.image})}" alt="ì•¨ë²” ì´ë¯¸ì§€" class="album-cover">
            </a>
            <div class="album-info">
              <p class="music-title" th:text="${music.title}">ê³¡ ì œëª©</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- êµ¬ë¶„ì„  -->
  <div class="section-divider"></div>

  <!-- ê°€ì¥ ë§ì´ ë‹´ê¸´ ì¥ë¥´ì˜ ìŒì•… ì¶œë ¥ -->
  <h1 class="favorite-title">
    ğŸ¤– ìŠ¤í”„ë§ë‹˜ì´ ì„ í˜¸í•˜ì‹œëŠ” ì¥ë¥´ëŠ” "<span class="singer-name" th:text="${mostFrequentGenre}"></span>" ì…ë‹ˆë‹¤.
  </h1>

  <div class="genre-musics">
    <p class="suggested-album-title">ì´ ì¥ë¥´ì˜ ë‹¤ë¥¸ ìŒì•…ë„ ë“¤ì–´ë³´ì„¸ìš”!</p>
    <div class="album-list">
      <div th:each="music : ${genreMusics}">
        <div class="album-item">
          <a th:href="@{/music/{idx}(idx=${music.idx})}">
            <img th:src="@{/img/album/{image}(image=${music.image})}" alt="ì•¨ë²” ì´ë¯¸ì§€" class="album-cover">
          </a>
          <div class="album-info">
            <p class="music-title" th:text="${music.title}">ê³¡ ì œëª©</p>
            <p class="music-singer" th:text="${music.singer}">ê°€ìˆ˜</p>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
</body>
</html>
